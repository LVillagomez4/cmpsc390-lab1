<!DOCTYPE html>
<html>

<head>
    <title>CMPSC300 Server Demo</title>
</head>

<body>

    <h1>CMPSC300 Server Demo</h1>

    <h2>Login</h2>
    <form id="loginForm">
        <label>Username</label><br />
        <input type="text" name="username" required /><br /><br />
        <label>Password</label><br />
        <input type="password" name="password" required /><br /><br />
        <button type="submit">Login</button>
    </form>
    <p id="loginResult"></p>

    <button id="loadUser">Load User</button>
    <p id="result"></p>

    <script>
        const btn = document.getElementById("loadUser");
        const result = document.getElementById("result");

        btn.addEventListener('click', async () => {
            try {
                const res = await fetch('/hello-user');
                const text = await res.text();
                result.textContent = text;
            } catch (err) {
                result.textContent = "Error";
            }
        });

        const loginForm = document.getElementById("loginForm");
        const loginResult = document.getElementById("loginResult");

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(loginForm);
            const username = formData.get('username');
            const password = formData.get('password');

            try {
                const res = await fetch('/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
                });
                const text = await res.text();
                loginResult.textContent = text;
            } catch (err) {
                loginResult.textContent = 'Error logging in';
            }
        });
    </script>

</body>

</html>
